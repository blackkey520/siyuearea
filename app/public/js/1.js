webpackJsonp([1],{170:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(213),u=a(n),d=r(4),s=a(d),o=r(2357),c=r(2356),i=r(2358),l=(r(440),r(63),r(285)),p=(a(l),r(9)),f=a(p),m=r(923);m.ListView.DataSource;t.default={namespace:"order",state:{usestate:0,orderdetail:{},recordsdetail:{},orderlist:[],selectedmobileorder:{},mobileorderlist:[],errormsg:"",pagination:{current:1,pageSize:10,total:0}},reducers:{updateState:function(e,t){var r=t.payload;return(0,s.default)({},e,r)},loaddataSuccess:function(e,t){var r=t.payload.data;return(0,s.default)({},e,{orderlist:r.data.record,pagination:{current:t.payload.current,pageSize:t.payload.pageSize,total:r.data.totalRecord||0}})},loaddataMobileSuccess:function(e,t){var r=t.payload.data;return(0,s.default)({},e,{mobileorderlist:r.data.record,pagination:{current:t.payload.current,pageSize:t.payload.pageSize,total:r.data.totalRecord||0}})}},subscriptions:{},effects:{addrecord:u.default.mark(function e(t,r){var a,n,d,s,c,l=t.payload,p=r.call,m=r.put;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={pid:l.pid,mid:l.mid,oid:l.oid,ostate:1,btime:(0,f.default)().format("YYYY-MM-DD HH:mm:ss"),etime:(0,f.default)().format("YYYY-MM-DD HH:mm:ss"),disid:1,discount:1,money:0,pdesc:l.pdesc},n=l.callback,d={},delete l.callback,l.ostate=1,l.otime=(0,f.default)(l.otime).format("YYYY-MM-DD HH:mm:ss"),l.pdesc="",delete l.pname,delete l.mname,delete l.btime,delete l.discount,delete l.disid,delete l.etime,delete l.money,e.next=16,p(o.updateorder,l);case 16:if(s=e.sent,!s.success){e.next=30;break}return e.next=20,p(o.add,a);case 20:if(c=e.sent,!c.success){e.next=27;break}return e.next=24,p(i.updateplace,{pid:l.pid,pstate:2});case 24:d=e.sent,e.next=28;break;case 27:d.success=!1;case 28:e.next=31;break;case 30:d.success=!1;case 31:return n&&n(d),e.next=34,m({type:"loadorder",payload:{oid:l.oid}});case 34:case"end":return e.stop()}},e,this)}),finishrecord:u.default.mark(function e(t,r){var a,n,d,s,l,p,m,h=t.payload,y=r.call,b=r.put;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b({type:"updateState",payload:{errormsg:""}});case 2:return a="",e.next=5,y(c.loadmemeber,{id:h.record.mid});case 5:if(n=e.sent,!n.success){e.next=54;break}if(d=n.data,!(d.mmoney>=h.param.money)){e.next=51;break}return d.mmoney=d.mmoney-h.param.money,d.mregisttime=(0,f.default)(d.mregisttime).format("YYYY-MM-DD HH:mm:ss"),delete d.nextOne,delete d.preOne,e.next=15,y(c.update,d);case 15:return s=e.sent,h.order.ostate=2,h.order.otime=(0,f.default)(h.otime).format("YYYY-MM-DD HH:mm:ss"),delete h.order.pname,delete h.order.mname,delete h.order.btime,delete h.order.discount,delete h.order.disid,delete h.order.etime,delete h.order.money,e.next=27,y(o.updateorder,h.order);case 27:if(l=e.sent,!l.success){e.next=48;break}return h.record.btime=(0,f.default)(h.record.btime).format("YYYY-MM-DD HH:mm:ss"),h.record.etime=h.param.etime,h.record.money=h.param.money,h.record.pdesc=h.param.pdesc,delete h.record.pname,delete h.record.mname,e.next=37,y(o.updaterecord,h.record);case 37:if(p=e.sent,!p.success){e.next=45;break}return e.next=41,y(i.updateplace,{pid:h.record.pid,pstate:0});case 41:m=e.sent,a=m.success?"success":"faild",e.next=46;break;case 45:a="faild";case 46:e.next=49;break;case 48:a="ordernotfound";case 49:e.next=52;break;case 51:a="outofmoney";case 52:e.next=55;break;case 54:a="usernotfound";case 55:return e.next=57,b({type:"updateState",payload:{errormsg:a}});case 57:h.callback(a);case 58:case"end":return e.stop()}},e,this)}),getorderlist:u.default.mark(function e(t,r){var a,n,d=t.payload,s=r.call,c=r.put;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={},d.mid&&(a.mid=d.mid),d.ordercode&&(a.ordercode=d.ordercode),e.next=5,s(o.querylist,d.page,d.pageSize,a);case 5:return n=e.sent,e.next=8,c({type:"loaddataSuccess",payload:{data:n,current:d.page,pageSize:d.pageSize}});case 8:case"end":return e.stop()}},e,this)}),getmobileorderlist:u.default.mark(function e(t,r){var a,n=t.payload,d=r.call,s=r.put;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d(o.querylist,n.page,n.pageSize,{mid:n.mid});case 2:return a=e.sent,e.next=5,s({type:"loaddataMobileSuccess",payload:{data:a,current:n.page,pageSize:n.pageSize}});case 5:case"end":return e.stop()}},e,this)}),loadorder:u.default.mark(function e(t,r){var a,n,d,s,c,i=t.payload,l=r.call,p=r.put;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p({type:"updateState",payload:{errormsg:""}});case 2:return a="",n={},d={},e.next=7,l(o.querylist,1,10,{oid:i.oid});case 7:return s=e.sent,e.next=10,l(o.queryrecordlist,1,10,{oid:i.oid});case 10:return c=e.sent,0!==s.data.record.length?s&&s.success&&(c&&c.success&&(0!==c.data.record.length?d=c.data.record[0]:1!==s.data.record[0].ostate&&2!==s.data.record[0].ostate||(a="err")),n=s.data.record[0]):a="none",e.next=14,p({type:"updateState",payload:{orderdetail:n,recordsdetail:d,errormsg:a}});case 14:case"end":return e.stop()}},e,this)}),saveorder:u.default.mark(function e(t,r){var a,n,d,s=t.payload,o=r.call;r.put;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null,n=null,d=s.callback,delete s.callback,null===s.param.id){e.next=11;break}return s.param.oid=s.param.id,delete s.param.id,e.next=8,o(c.update,s.param);case 8:a=e.sent,e.next=15;break;case 11:return delete s.param.id,e.next=14,o(register,s.param);case 14:a=e.sent;case 15:d&&d(a);case 16:case"end":return e.stop()}},e,this)})}},e.exports=t.default},2356:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getusrmsg=t.update=t.loadmemeber=t.querylist=t.register=void 0;var n=r(213),u=a(n),d=r(431),s=a(d),o=(t.register=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Member",method:"POST",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.querylist=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Member",method:"GET",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.loadmemeber=function(){var e=(0,s.default)(u.default.mark(function e(t){var r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id||0,a="/api/restql/Base_Member/"+r,e.abrupt("return",(0,o.request)({url:a,method:"get"}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.update=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Member/"+t.mid,method:"put",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.getusrmsg=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/wechat/getusr/"+t.code,method:"get"}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(99))},2357:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updaterecord=t.updateorder=t.queryrecordlist=t.loadmemeber=t.querylist=t.add=t.addorder=void 0;var n=r(213),u=a(n),d=r(431),s=a(d),o=(t.addorder=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Order",method:"POST",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.add=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Record",method:"POST",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.querylist=function(){var e=(0,s.default)(u.default.mark(function e(t,r,a){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/order/getorderlist?page="+t+"&pageSize="+r,method:"POST",data:a}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,a){return e.apply(this,arguments)}}(),t.loadmemeber=function(){var e=(0,s.default)(u.default.mark(function e(t){var r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id||0,a="/api/restql/Base_Order/"+r,e.abrupt("return",(0,o.request)({url:a,method:"get"}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.queryrecordlist=function(){var e=(0,s.default)(u.default.mark(function e(t,r,a){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/order/getrecordlist?page="+t+"&pageSize="+r,method:"POST",data:a}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,a){return e.apply(this,arguments)}}(),t.updateorder=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Order/"+t.oid,method:"put",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.updaterecord=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Record/"+t.rid,method:"put",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(99))},2358:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updateplace=t.querylist=void 0;var n=r(213),u=a(n),d=r(431),s=a(d),o=(t.querylist=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Place",method:"GET",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.updateplace=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Place/"+t.pid,method:"put",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(99))}});