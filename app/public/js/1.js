webpackJsonp([1],{157:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=r(194),u=a(n),d=r(4),s=a(d),o=r(2157),c=r(2156),i=r(2158),l=r(2103),p=(r(399),r(58),r(255)),f=(a(p),r(9)),m=a(f),y=r(836);y.ListView.DataSource;t.default={namespace:"order",state:{usestate:0,orderdetail:{},recordsdetail:{},memberdetail:{},orderlist:[],selectedmobileorder:{},mobileorderlist:[],mobilemember:{},errormsg:"",pagination:{current:1,pageSize:10,total:0}},reducers:{updateState:function(e,t){var r=t.payload;return(0,s.default)({},e,r)},loaddataSuccess:function(e,t){var r=t.payload.data;return(0,s.default)({},e,{orderlist:r.data.record,pagination:{current:t.payload.current,pageSize:t.payload.pageSize,total:r.data.totalRecord||0}})},loaddataMobileSuccess:function(e,t){var r=t.payload.data;return(0,s.default)({},e,{mobileorderlist:1!==t.payload.current?e.mobileorderlist.concat(r.data.record):r.data.record,pagination:{current:t.payload.current,pageSize:t.payload.pageSize,total:r.data.totalRecord||0}})}},subscriptions:{},effects:{addrecord:u.default.mark(function e(t,r){var a,n,d,s,c,l=t.payload,p=r.call,f=r.put;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={pid:l.pid,mid:l.mid,oid:l.oid,ostate:0,btime:(0,m.default)().format("YYYY-MM-DD HH:mm:ss"),etime:(0,m.default)().format("YYYY-MM-DD HH:mm:ss"),disid:1,discount:1,money:0,pdesc:l.pdesc},n=l.callback,d={},delete l.callback,delete l.restate,l.ostate=1,l.otime=(0,m.default)(l.otime).format("YYYY-MM-DD HH:mm:ss"),l.pdesc="",delete l.pname,delete l.mname,delete l.btime,delete l.discount,delete l.disid,delete l.etime,delete l.money,delete l.rstate,e.next=18,p(o.updateorder,l);case 18:if(s=e.sent,!s.success){e.next=32;break}return e.next=22,p(o.add,a);case 22:if(c=e.sent,!c.success){e.next=29;break}return e.next=26,p(i.updateplace,{pid:l.pid,pstate:2});case 26:d=e.sent,e.next=30;break;case 29:d.success=!1;case 30:e.next=33;break;case 32:d.success=!1;case 33:return n&&n(d),e.next=36,f({type:"loadorder",payload:{oid:l.oid}});case 36:case"end":return e.stop()}},e,this)}),finishrecord:u.default.mark(function e(t,r){var a,n,d,s,p,f,y,h,b,v,x,g,w,k=t.payload,q=r.call,S=r.put,_=r.select;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S({type:"updateState",payload:{errormsg:""}});case 2:return a="",e.next=5,_(function(e){return e.order});case 5:if(n=e.sent,d=n.memberdetail,s={},s.mid=d.mid,p=(0,m.default)(d.etime).diff((0,m.default)(),"days",!1),!(null!=d.pcname&&p>0)){e.next=18;break}s.atype=3,s.amoney=0,s.asmoney=0,s.adesc=d.pcname,k.record.ostate=3,e.next=51;break;case 18:if(0!==d.mtype){e.next=41;break}if(!(d.mmoney>=k.param.money)){e.next=38;break}return d.mmoney=d.mmoney-k.param.money,d.mregisttime=(0,m.default)(d.mregisttime).format("YYYY-MM-DD HH:mm:ss"),delete d.pcname,delete d.btime,delete d.etime,delete d.isused,delete d.pcdesc,delete d.value,e.next=30,q(c.update,d);case 30:f=e.sent,s.atype=1,s.amoney=k.param.money,s.asmoney=k.param.money,s.adesc="充值消费",k.record.ostate=1,e.next=39;break;case 38:a="outofmoney";case 39:e.next=51;break;case 41:y=(0,m.default)(d.mregisttime),y=1===d.mtype?y.add(1,"days"):2===d.mtype?y.add(1,"weeks"):3===d.mtype?y.add(1,"months"):y.add(1,"quarters"),h=(0,m.default)(),b=h.diff(y,"hours",!0),Math.ceil(b)>0&&(a="outofcardtime"),s.atype=2,s.amoney=0,s.asmoney=0,s.adesc=1===d.mtype?"日卡消费":2===d.mtype?"周卡消费":3===d.mtype?"月卡消费":"季卡消费",k.record.ostate=2;case 51:if(s.atime=(0,m.default)().format("YYYY-MM-DD HH:mm:ss"),s.astate=1,""!==a){e.next=92;break}return e.next=56,q(l.addaccournt,s);case 56:return v=e.sent,k.order.ostate=2,k.order.otime=(0,m.default)(k.otime).format("YYYY-MM-DD HH:mm:ss"),delete k.order.pname,delete k.order.mname,delete k.order.btime,delete k.order.discount,delete k.order.disid,delete k.order.etime,delete k.order.money,delete k.order.rstate,e.next=69,q(o.updateorder,k.order);case 69:if(x=e.sent,!x.success){e.next=91;break}return k.record.btime=(0,m.default)(k.record.btime).format("YYYY-MM-DD HH:mm:ss"),k.record.etime=k.param.etime,k.record.money=k.param.money,k.record.pdesc=k.param.pdesc,delete k.record.pname,delete k.record.mname,delete k.record.rstate,e.next=80,q(o.updaterecord,k.record);case 80:if(g=e.sent,!g.success){e.next=88;break}return e.next=84,q(i.updateplace,{pid:k.record.pid,pstate:0});case 84:w=e.sent,a=w.success?"success":"faild",e.next=89;break;case 88:a="faild";case 89:e.next=92;break;case 91:a="ordernotfound";case 92:return e.next=94,S({type:"updateState",payload:{errormsg:a}});case 94:k.callback(a);case 95:case"end":return e.stop()}},e,this)}),getorderlist:u.default.mark(function e(t,r){var a,n,d=t.payload,s=r.call,c=r.put;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={},d.mid&&(a.mid=d.mid),d.ordercode&&(a.ordercode=d.ordercode),e.next=5,s(o.querylist,d.page,d.pageSize,a);case 5:return n=e.sent,e.next=8,c({type:"loaddataSuccess",payload:{data:n,current:d.page,pageSize:d.pageSize}});case 8:case"end":return e.stop()}},e,this)}),getmobileorderlist:u.default.mark(function e(t,r){var a,n,d=t.payload,s=r.call,i=r.put;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(o.querylist,d.page,d.pageSize,{mid:d.mid});case 2:return a=e.sent,e.next=5,s(c.loadmemeber,{id:d.mid});case 5:return n=e.sent,e.next=8,i({type:"loaddataMobileSuccess",payload:{mobilemember:n.data,data:a,current:d.page,pageSize:d.pageSize}});case 8:case"end":return e.stop()}},e,this)}),loadorder:u.default.mark(function e(t,r){var a,n,d,s,i,l,p,f=t.payload,m=r.call,y=r.put;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y({type:"updateState",payload:{errormsg:""}});case 2:return a="",n={},d={},s={},e.next=8,m(o.querylist,1,10,{oid:f.oid});case 8:return i=e.sent,e.next=11,m(o.queryrecordlist,1,10,{oid:f.oid});case 11:if(l=e.sent,0===i.data.record.length){e.next=22;break}if(!i||!i.success){e.next=20;break}return l&&l.success&&(0!==l.data.record.length?d=l.data.record[0]:1!==i.data.record[0].ostate&&2!==i.data.record[0].ostate||(a="err")),n=i.data.record[0],e.next=18,m(c.loadmemeber,{id:i.data.record[0].mid});case 18:p=e.sent,p&&p.success&&(s=p.data);case 20:e.next=23;break;case 22:a="none";case 23:return e.next=25,y({type:"updateState",payload:{orderdetail:n,recordsdetail:d,memberdetail:s,errormsg:a}});case 25:case"end":return e.stop()}},e,this)})}},e.exports=t.default},2103:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updates=t.querylist=t.addaccournt=void 0;var n=r(194),u=a(n),d=r(389),s=a(d),o=(t.addaccournt=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Accounts",method:"POST",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.querylist=function(){var e=(0,s.default)(u.default.mark(function e(t,r,a){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/accounts/getaccountslist?page="+t+"&pageSize="+r,method:"POST",data:a}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,a){return e.apply(this,arguments)}}(),t.updates=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Accounts/"+t.oid,method:"put",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(92))},2156:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getusrmsg=t.update=t.loadmemberbyphone=t.loadmemeber=t.querylist=t.register=void 0;var n=r(194),u=a(n),d=r(389),s=a(d),o=(t.register=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Member",method:"POST",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.querylist=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/member/getmemberlist",method:"POST",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.loadmemeber=function(){var e=(0,s.default)(u.default.mark(function e(t){var r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id||0,a="/api/member/getsinglemember/"+r,e.abrupt("return",(0,o.request)({url:a,method:"get"}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.loadmemberbyphone=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Member",method:"GET",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.update=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Member/"+t.mid,method:"put",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.getusrmsg=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/wechat/getusr/"+t.code,method:"get"}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(92))},2157:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updaterecord=t.updateorder=t.queryrecordlist=t.loadmemeber=t.querylist=t.add=t.addorder=void 0;var n=r(194),u=a(n),d=r(389),s=a(d),o=(t.addorder=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Order",method:"POST",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.add=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Record",method:"POST",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.querylist=function(){var e=(0,s.default)(u.default.mark(function e(t,r,a){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/order/getorderlist?page="+t+"&pageSize="+r,method:"POST",data:a}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,a){return e.apply(this,arguments)}}(),t.loadmemeber=function(){var e=(0,s.default)(u.default.mark(function e(t){var r,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.id||0,a="/api/restql/Base_Order/"+r,e.abrupt("return",(0,o.request)({url:a,method:"get"}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.queryrecordlist=function(){var e=(0,s.default)(u.default.mark(function e(t,r,a){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/order/getrecordlist?page="+t+"&pageSize="+r,method:"POST",data:a}));case 1:case"end":return e.stop()}},e,this)}));return function(t,r,a){return e.apply(this,arguments)}}(),t.updateorder=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Order/"+t.oid,method:"put",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.updaterecord=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Record/"+t.rid,method:"put",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(92))},2158:function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updateplace=t.querylist=void 0;var n=r(194),u=a(n),d=r(389),s=a(d),o=(t.querylist=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Place",method:"GET",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.updateplace=function(){var e=(0,s.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)({url:"/api/restql/Base_Place/"+t.pid,method:"put",data:t}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(92))}});